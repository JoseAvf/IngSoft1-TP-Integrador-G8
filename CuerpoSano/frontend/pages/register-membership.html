<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CuerpoSano | Registrar Membresías</title>
    <style>
        body {
            display: none;
        }
    </style>
    <script src="../js/auth.js"></script>
    <link rel="stylesheet" href="../css/pages/memberships.css" />
    <link rel="stylesheet" href="../css/components/modal.css" />
    <link rel="stylesheet" href="../css/base/style.css" />
</head>
<body>

    <!-- Header unificado -->
    <header class="main-header">
        <a href="./index.html" class="logo-link">
            <h1>🏋️‍♂️ CuerpoSano — Sistema de Gestión de Gimnasio</h1>
        </a>
        <nav class="user-nav">
            <span id="userRole">👤 Empleado</span>
            <button id="logoutBtn">Cerrar Sesión</button>
        </nav>
    </header>

    <main>
        <section class="form-section">
            <h2>Registrar Nueva Membresía</h2>

            <form id="membershipForm">
                <fieldset>
                    <legend>Datos del miembro</legend>
                    <label>DNI:</label>
                    <input type="text" name="dni" required>
                    <label>
                        <input type="checkbox" name="esEstudiante">
                        Estudiante
                    </label>
                </fieldset>

                <fieldset>
                    <legend>Membresía</legend>
                    <div class="membership-select">
                        <input type="text" id="membresiaTipo" placeholder="Seleccionar tipo..." readonly>
                        <input type="hidden" name="membresiaId" id="membresiaId">
                        <button type="button" id="btnSelectMembership">Elegir Membresía</button>
                    </div>
                    <div id="membershipSummary" class="summary-box">
                        <p>💰 Costo base: <span id="costoBase">-</span></p>
                        <p>🎓 Descuento aplicado: <span id="descuento">%0</span></p>
                        <p><strong>Total a pagar: <span id="totalPagar">-</span></strong></p>
                    </div>
                </fieldset>
                <div id="btnPagarContainer" class="hidden">
                    <button type="button" id="btnPagar" class="btn-pagar">💳 Realizar Pago</button>
                </div>

                <button type="submit">Asignar Membresía</button>
                <div id="memberFormResult"></div>
            </form>

            <!-- Modal para membresías -->
            <div id="membershipModal" class="modal hidden">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <h3>Seleccionar tipo de membresía</h3>
                    <table id="membershipTable">
                        <thead>
                            <tr>
                                <th>Tipo</th>
                                <th>Duración</th>
                                <th>Costo</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div id="paymentModal" class="modal hidden">
                <div class="modal-content">
                    <h3>Confirmar Pago</h3>
                    <p>Membresía: <span id="resumenTipo"></span></p>
                    <p>Total a pagar: <span id="resumenTotal"></span></p>
                    <label for="metodoPago">Método de pago:</label>
                    <select id="metodoPago">
                        <option value="">-- Seleccionar --</option>
                        <option value="Efectivo">Efectivo</option>
                        <option value="Transferencia Bancaria">Transferencia Bancaria</option>
                        <option value="Crédito">Crédito</option>
                        <option value="Débito">Débito</option>
                        <option value="Mercado Pago">Mercado Pago</option>
                    </select>
                    <div class="modal-buttons">
                        <button id="btnConfirmarPago" class="btn btn-success">Confirmar Pago</button>
                        <button id="btnCancelarPago" class="btn btn-secondary">Cancelar</button>
                    </div>
                </div>
            </div>

        </section>

        <!-- 🔙 Botón para volver -->
        <div class="back-container">
            <a href="./memberships.html" class="btn-back">⬅️ Volver atrás</a>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>© 2025 CuerpoSano — Todos los derechos reservados</p>
    </footer>

    <script type="module" src="../js/features/memberships/membershipRegistration.js"></script>
    <script>

        document.getElementById('logoutBtn').addEventListener('click', () => {
            localStorage.removeItem('userRole');
            alert('Sesión cerrada correctamente');
            window.location.href = 'login.html';
        });
    </script>

</body>
</html>
